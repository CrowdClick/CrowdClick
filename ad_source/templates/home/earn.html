{% extends "home/base.html" %}
{% load static %}


{% block title %}Earn{% endblock title %}

{% block content %}

<iframe id="ads" src="{{ ad.website_link }}" frameborder="0"
    style="width: 100%; height: 100%; min-height: 500px"></iframe>
<form action="{% url "earn" ad.id %}" method="post">
    {% csrf_token %}
    <table>
        {% for question in ad.questions.all %}
        <tr>
            <th>
                <label for="question_{{ question.id }}">{{ question.title }}</label> <br>
                {% if question.question_type == 'RA' %}
                {% for answer in question.answers.all %}
                <input type="radio" name="question_{{ question.id }}" value="{{answer.id}}">{{answer.title}}<br>
                {% endfor %}
                {% elif question.question_type == 'SE' %}
                {% for answer in question.answers.all %}
                <input type="checkbox" name="question_{{ question.id }}" value="{{ answer.id }}">{{ answer.title }}<br>
                {% endfor %}
                {% endif %}
            </th>
        </tr>
        {% endfor %}
        <tr>
            <td>
                <input type="submit" value="Submit">
            </td>
        </tr>
    </table>
</form>
<script>
    const iframeEl = document.getElementById("ads");
    console.log("iframeel", iframeEl)

    let startDate;
    let elapsedTime = 0;

    const focus =  () => {
        startDate = new Date();
        console.log("focus triggered")
    };

    const blur =  () => {
        const endDate = new Date();
        const spentTime = endDate.getTime() - startDate.getTime();
        elapsedTime += spentTime;
        console.log("ELAPSEDTIME", elapsedTime)

    };

    const beforeunload =  () => {
        const endDate = new Date();
        const spentTime = endDate.getTime() - startDate.getTime();
        elapsedTime += spentTime;
        console.log("ELAPSEDTIME", elapsedTime)



    };


    iframeEl.addEventListener('focus', focus);
    iframeEl.addEventListener('blur', blur);
    iframeEl.addEventListener('beforeunload', beforeunload);

</script>
{% endblock %}